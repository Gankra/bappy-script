<!doctype html><html class="dark" id="oranda" lang="en"><head><title>bappy-script</title><meta charset="utf-8"/><meta content="width=device-width, initial-scale=1.0" name="viewport"/><meta content="Just messing around with a toy compiler" name="description"/><meta content="Just messing around with a toy compiler" name="description"/><meta content="Just messing around with a toy compiler" property="og:description"/><meta content="website" property="og:type"/><meta content="bappy-script" property="og:title"/><meta content="interest-cohort=()" http_equiv="Permissions-Policy"/><link href="/bappy-script/oranda.css" rel="stylesheet"/></head><body><div class="container"><div class="repo_banner"><a href="https://github.com/Gankra/bappy-script"><div class="github-icon" aria-hidden="true"></div>Check out our GitHub</a></div><main><header><h1 class="title">bappy-script</h1><nav class="nav"><ul><li><a href="/bappy-script">Home</a></li><li><a href="/bappy-script/artifacts.html">Install</a></li><li><a href="/bappy-script/changelog.html">Changelog</a></li></ul></nav></header><div><div class="artifacts"><div class="artifact-header hidden target" data-targets="aarch64-apple-darwin "><h4>Install v0.1.0</h4><div><small class="published-date">Published at May 12 2023 at 15:44 UTC</small></div><div class="install-code-wrapper"><pre style="background-color:#263238;">
<span style="color:#82aaff;">curl</span><span style="color:#89ddff;"> --</span><span style="color:#f78c6c;">proto </span><span style="color:#89ddff;">&#39;</span><span style="color:#c3e88d;">=https</span><span style="color:#89ddff;">&#39; --</span><span style="color:#f78c6c;">tlsv1</span><span style="color:#82aaff;">.2</span><span style="color:#89ddff;"> -</span><span style="color:#f78c6c;">LsSf</span><span style="color:#82aaff;"> https://github.com/Gankra/bappy-script/releases/download/v0.1.0/bappy-script-installer.sh </span><span style="color:#89ddff;">| </span><span style="color:#82aaff;">sh</span></pre>
<button class="button copy-clipboard-button primary" data-copy="curl --proto &#39;=https&#39; --tlsv1.2 -LsSf https://github.com/Gankra/bappy-script/releases/download/v0.1.0/bappy-script-installer.sh | sh"><svg stroke='currentColor' fill='currentColor' stroke-width='0' viewBox='0 0 20 20' height='1em' width='1em' xmlns='http://www.w3.org/2000/svg'><path d='M8 2a1 1 0 000 2h2a1 1 0 100-2H8z'></path><path d='M3 5a2 2 0 012-2 3 3 0 003 3h2a3 3 0 003-3 2 2 0 012 2v6h-4.586l1.293-1.293a1 1 0 00-1.414-1.414l-3 3a1 1 0 000 1.414l3 3a1 1 0 001.414-1.414L10.414 13H15v3a2 2 0 01-2 2H5a2 2 0 01-2-2V5zM15 11h2a1 1 0 110 2h-2v-2z'></path></svg></button><a class="button primary" href="bappy-script-installer.sh.txt">Source</a></div><div><span class="detect">We have detected you are on <span class="detected-os">arm mac</span>, are we wrong?</span><a href="/bappy-script/artifacts.html">View all installation options</a></div></div><div class="artifact-header hidden target" data-targets="x86_64-apple-darwin "><h4>Install v0.1.0</h4><div><small class="published-date">Published at May 12 2023 at 15:44 UTC</small></div><div class="install-code-wrapper"><pre style="background-color:#263238;">
<span style="color:#82aaff;">curl</span><span style="color:#89ddff;"> --</span><span style="color:#f78c6c;">proto </span><span style="color:#89ddff;">&#39;</span><span style="color:#c3e88d;">=https</span><span style="color:#89ddff;">&#39; --</span><span style="color:#f78c6c;">tlsv1</span><span style="color:#82aaff;">.2</span><span style="color:#89ddff;"> -</span><span style="color:#f78c6c;">LsSf</span><span style="color:#82aaff;"> https://github.com/Gankra/bappy-script/releases/download/v0.1.0/bappy-script-installer.sh </span><span style="color:#89ddff;">| </span><span style="color:#82aaff;">sh</span></pre>
<button class="button copy-clipboard-button primary" data-copy="curl --proto &#39;=https&#39; --tlsv1.2 -LsSf https://github.com/Gankra/bappy-script/releases/download/v0.1.0/bappy-script-installer.sh | sh"><svg stroke='currentColor' fill='currentColor' stroke-width='0' viewBox='0 0 20 20' height='1em' width='1em' xmlns='http://www.w3.org/2000/svg'><path d='M8 2a1 1 0 000 2h2a1 1 0 100-2H8z'></path><path d='M3 5a2 2 0 012-2 3 3 0 003 3h2a3 3 0 003-3 2 2 0 012 2v6h-4.586l1.293-1.293a1 1 0 00-1.414-1.414l-3 3a1 1 0 000 1.414l3 3a1 1 0 001.414-1.414L10.414 13H15v3a2 2 0 01-2 2H5a2 2 0 01-2-2V5zM15 11h2a1 1 0 110 2h-2v-2z'></path></svg></button><a class="button primary" href="bappy-script-installer.sh.txt">Source</a></div><div><span class="detect">We have detected you are on <span class="detected-os">mac</span>, are we wrong?</span><a href="/bappy-script/artifacts.html">View all installation options</a></div></div><div class="artifact-header hidden target" data-targets="x86_64-pc-windows-msvc "><h4>Install v0.1.0</h4><div><small class="published-date">Published at May 12 2023 at 15:44 UTC</small></div><div class="install-code-wrapper"><pre style="background-color:#263238;">
<span style="color:#82aaff;">irm https://github.com/Gankra/bappy-script/releases/download/v0.1.0/bappy-script-installer.ps1 </span><span style="color:#89ddff;">| </span><span style="color:#82aaff;">iex</span></pre>
<button class="button copy-clipboard-button primary" data-copy="irm https://github.com/Gankra/bappy-script/releases/download/v0.1.0/bappy-script-installer.ps1 | iex"><svg stroke='currentColor' fill='currentColor' stroke-width='0' viewBox='0 0 20 20' height='1em' width='1em' xmlns='http://www.w3.org/2000/svg'><path d='M8 2a1 1 0 000 2h2a1 1 0 100-2H8z'></path><path d='M3 5a2 2 0 012-2 3 3 0 003 3h2a3 3 0 003-3 2 2 0 012 2v6h-4.586l1.293-1.293a1 1 0 00-1.414-1.414l-3 3a1 1 0 000 1.414l3 3a1 1 0 001.414-1.414L10.414 13H15v3a2 2 0 01-2 2H5a2 2 0 01-2-2V5zM15 11h2a1 1 0 110 2h-2v-2z'></path></svg></button><a class="button primary" href="bappy-script-installer.ps1.txt">Source</a></div><div><span class="detect">We have detected you are on <span class="detected-os">windows</span>, are we wrong?</span><a href="/bappy-script/artifacts.html">View all installation options</a></div></div><div class="artifact-header hidden target" data-targets="x86_64-unknown-linux-gnu "><h4>Install v0.1.0</h4><div><small class="published-date">Published at May 12 2023 at 15:44 UTC</small></div><div class="install-code-wrapper"><pre style="background-color:#263238;">
<span style="color:#82aaff;">curl</span><span style="color:#89ddff;"> --</span><span style="color:#f78c6c;">proto </span><span style="color:#89ddff;">&#39;</span><span style="color:#c3e88d;">=https</span><span style="color:#89ddff;">&#39; --</span><span style="color:#f78c6c;">tlsv1</span><span style="color:#82aaff;">.2</span><span style="color:#89ddff;"> -</span><span style="color:#f78c6c;">LsSf</span><span style="color:#82aaff;"> https://github.com/Gankra/bappy-script/releases/download/v0.1.0/bappy-script-installer.sh </span><span style="color:#89ddff;">| </span><span style="color:#82aaff;">sh</span></pre>
<button class="button copy-clipboard-button primary" data-copy="curl --proto &#39;=https&#39; --tlsv1.2 -LsSf https://github.com/Gankra/bappy-script/releases/download/v0.1.0/bappy-script-installer.sh | sh"><svg stroke='currentColor' fill='currentColor' stroke-width='0' viewBox='0 0 20 20' height='1em' width='1em' xmlns='http://www.w3.org/2000/svg'><path d='M8 2a1 1 0 000 2h2a1 1 0 100-2H8z'></path><path d='M3 5a2 2 0 012-2 3 3 0 003 3h2a3 3 0 003-3 2 2 0 012 2v6h-4.586l1.293-1.293a1 1 0 00-1.414-1.414l-3 3a1 1 0 000 1.414l3 3a1 1 0 001.414-1.414L10.414 13H15v3a2 2 0 01-2 2H5a2 2 0 01-2-2V5zM15 11h2a1 1 0 110 2h-2v-2z'></path></svg></button><a class="button primary" href="bappy-script-installer.sh.txt">Source</a></div><div><span class="detect">We have detected you are on <span class="detected-os">linux</span>, are we wrong?</span><a href="/bappy-script/artifacts.html">View all installation options</a></div></div><a class="backup-download business-button hidden primary" href="/bappy-script/artifacts.html">View installation options</a></div><h1>bappy-script</h1>
<p>Just messing around with a toy compiler.</p>
<p>bappy-script is primarily a playground for learning how static type systems work
(checker.rs). The parser and interpreter <em>work</em> but are an after-thought by comparison.</p>
<h1>Everything Test Program</h1>
<p>This program roughly demonstrates everything the language can do, including:</p>
<p>Basics:</p>
<ul>
<li>Basic primitives (Bool, Int, Str, <code>()</code>)</li>
<li>Basic control flow (ret, if, else, loop, break, continue)</li>
<li>Basic mutable variables (let, set)</li>
<li>Builtin functions provide add/sub/mul for math and eq/not for conditions</li>
</ul>
<p>Types:</p>
<ul>
<li>First-class functions (which are all closures)
<ul>
<li>Closures capture state by-value at the point where execution reaches their decl.</li>
</ul>
</li>
<li>Structural product types (tuples)</li>
<li>Nominal product types (structs)</li>
</ul>
<p>Analysis:</p>
<ul>
<li>Optional Static type checking
<ul>
<li>Types of variables can be inferred because exprs currently always have a known type.</li>
<li>Functions must always declare the types of args/returns
<ul>
<li>Although if the return type is omitted it's assumed to be <code>()</code></li>
</ul>
</li>
<li>Properly handles shadowing and scoping of nominal types</li>
</ul>
</li>
<li>Statically validates variable accesses are in scope</li>
<li>Statically validates control flow (can't <code>continue</code> outside a loop)</li>
<li>Statically computes closure captures</li>
</ul>
<pre style="background-color:#263238;"><span style="font-style:italic;color:#c792ea;">fn </span><span style="color:#82aaff;">print_1d_point</span><span style="color:#89ddff;">() {
</span><span style="color:#eeffff;">    </span><span style="font-style:italic;color:#c792ea;">struct </span><span style="color:#eeffff;">Point </span><span style="color:#89ddff;">{
</span><span style="color:#eeffff;">        x</span><span style="color:#89ddff;">:</span><span style="color:#eeffff;"> Int
</span><span style="color:#eeffff;">    </span><span style="color:#89ddff;">}
</span><span style="color:#eeffff;">    </span><span style="font-style:italic;color:#c792ea;">let</span><span style="color:#eeffff;"> x </span><span style="color:#89ddff;">=</span><span style="color:#eeffff;"> Point </span><span style="color:#89ddff;">{</span><span style="color:#eeffff;"> x</span><span style="color:#89ddff;">: </span><span style="color:#f78c6c;">1 </span><span style="color:#89ddff;">}
</span><span style="color:#eeffff;">    print x
</span><span style="color:#eeffff;">    ret </span><span style="color:#89ddff;">()
</span><span style="color:#89ddff;">}
</span><span style="color:#eeffff;">
</span><span style="font-style:italic;color:#c792ea;">let </span><span style="color:#89ddff;">_ = </span><span style="color:#82aaff;">print_1d_point</span><span style="color:#89ddff;">()
</span><span style="font-style:italic;color:#c792ea;">let</span><span style="color:#eeffff;"> print_point</span><span style="color:#89ddff;">: </span><span style="font-style:italic;color:#c792ea;">fn</span><span style="color:#89ddff;">() -&gt; () =</span><span style="color:#eeffff;"> print_1d_point
</span><span style="font-style:italic;color:#c792ea;">let </span><span style="color:#89ddff;">_ = </span><span style="color:#82aaff;">print_point</span><span style="color:#89ddff;">()
</span><span style="color:#eeffff;">
</span><span style="font-style:italic;color:#c792ea;">let</span><span style="color:#eeffff;"> tuple </span><span style="color:#89ddff;">= (</span><span style="color:#f78c6c;">1</span><span style="color:#89ddff;">, (</span><span style="color:#f78c6c;">true</span><span style="color:#89ddff;">, "</span><span style="color:#c3e88d;">hello</span><span style="color:#89ddff;">"), </span><span style="color:#f78c6c;">false</span><span style="color:#89ddff;">)
</span><span style="font-style:italic;color:#c792ea;">if</span><span style="color:#eeffff;"> tuple.</span><span style="color:#f78c6c;">1.0 </span><span style="color:#89ddff;">{
</span><span style="color:#eeffff;">    </span><span style="font-style:italic;color:#c792ea;">struct </span><span style="color:#eeffff;">Point </span><span style="color:#89ddff;">{
</span><span style="color:#eeffff;">        x</span><span style="color:#89ddff;">:</span><span style="color:#eeffff;"> Int
</span><span style="color:#eeffff;">        y</span><span style="color:#89ddff;">:</span><span style="color:#eeffff;"> Int
</span><span style="color:#eeffff;">    </span><span style="color:#89ddff;">}
</span><span style="color:#eeffff;">
</span><span style="color:#eeffff;">    </span><span style="font-style:italic;color:#c792ea;">let</span><span style="color:#eeffff;"> captured_point </span><span style="color:#89ddff;">=</span><span style="color:#eeffff;"> Point </span><span style="color:#89ddff;">{</span><span style="color:#eeffff;"> x</span><span style="color:#89ddff;">: </span><span style="color:#f78c6c;">2</span><span style="color:#89ddff;">,</span><span style="color:#eeffff;"> y</span><span style="color:#89ddff;">: </span><span style="color:#f78c6c;">4 </span><span style="color:#89ddff;">}
</span><span style="color:#eeffff;">    </span><span style="font-style:italic;color:#c792ea;">fn </span><span style="color:#82aaff;">print_2d_point</span><span style="color:#89ddff;">() {
</span><span style="color:#eeffff;">        print captured_point
</span><span style="color:#eeffff;">        ret </span><span style="color:#89ddff;">()
</span><span style="color:#eeffff;">    </span><span style="color:#89ddff;">}
</span><span style="color:#eeffff;">
</span><span style="color:#eeffff;">    </span><span style="font-style:italic;color:#c792ea;">let </span><span style="color:#89ddff;">_ = </span><span style="color:#82aaff;">print_2d_point</span><span style="color:#89ddff;">();
</span><span style="color:#eeffff;">    set print_point </span><span style="color:#89ddff;">=</span><span style="color:#eeffff;"> print_2d_point
</span><span style="color:#89ddff;">}
</span><span style="color:#eeffff;">
</span><span style="font-style:italic;color:#c792ea;">struct </span><span style="color:#eeffff;">Point </span><span style="color:#89ddff;">{
</span><span style="color:#eeffff;">    x</span><span style="color:#89ddff;">:</span><span style="color:#eeffff;"> Int
</span><span style="color:#eeffff;">    y</span><span style="color:#89ddff;">:</span><span style="color:#eeffff;"> Int
</span><span style="color:#eeffff;">    z</span><span style="color:#89ddff;">:</span><span style="color:#eeffff;"> Int
</span><span style="color:#89ddff;">}
</span><span style="color:#eeffff;">
</span><span style="font-style:italic;color:#c792ea;">fn </span><span style="color:#82aaff;">print_3d_point</span><span style="color:#89ddff;">() -&gt;</span><span style="color:#eeffff;"> Int </span><span style="color:#89ddff;">{
</span><span style="color:#eeffff;">    </span><span style="font-style:italic;color:#c792ea;">let</span><span style="color:#eeffff;"> pt</span><span style="color:#89ddff;">:</span><span style="color:#eeffff;"> Point </span><span style="color:#89ddff;">=</span><span style="color:#eeffff;"> Point </span><span style="color:#89ddff;">{</span><span style="color:#eeffff;"> x</span><span style="color:#89ddff;">: </span><span style="color:#f78c6c;">3</span><span style="color:#89ddff;">,</span><span style="color:#eeffff;"> y</span><span style="color:#89ddff;">: </span><span style="color:#f78c6c;">5</span><span style="color:#89ddff;">,</span><span style="color:#eeffff;"> z</span><span style="color:#89ddff;">: </span><span style="color:#f78c6c;">7 </span><span style="color:#89ddff;">}
</span><span style="color:#eeffff;">    print pt
</span><span style="color:#eeffff;">    ret </span><span style="color:#82aaff;">add</span><span style="color:#89ddff;">(</span><span style="color:#82aaff;">add</span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">pt.x</span><span style="color:#89ddff;">,</span><span style="color:#eeffff;"> pt.y</span><span style="color:#89ddff;">),</span><span style="color:#eeffff;"> pt.z</span><span style="color:#89ddff;">)
</span><span style="color:#89ddff;">}
</span><span style="color:#eeffff;">
</span><span style="font-style:italic;color:#c792ea;">fn </span><span style="color:#82aaff;">print_many</span><span style="color:#89ddff;">() {
</span><span style="color:#eeffff;">    print </span><span style="color:#89ddff;">"</span><span style="color:#c3e88d;">3 more times!!!</span><span style="color:#89ddff;">"
</span><span style="color:#eeffff;">    </span><span style="font-style:italic;color:#c792ea;">let</span><span style="color:#eeffff;"> counter </span><span style="color:#89ddff;">= </span><span style="color:#f78c6c;">3
</span><span style="color:#eeffff;">    </span><span style="font-style:italic;color:#c792ea;">loop </span><span style="color:#89ddff;">{
</span><span style="color:#eeffff;">        </span><span style="font-style:italic;color:#c792ea;">if </span><span style="color:#82aaff;">eq</span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">counter</span><span style="color:#89ddff;">, </span><span style="color:#f78c6c;">0</span><span style="color:#89ddff;">) {
</span><span style="color:#eeffff;">            </span><span style="font-style:italic;color:#c792ea;">break
</span><span style="color:#eeffff;">        </span><span style="color:#89ddff;">}
</span><span style="color:#eeffff;">        set counter </span><span style="color:#89ddff;">= </span><span style="color:#82aaff;">sub</span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">counter</span><span style="color:#89ddff;">, </span><span style="color:#f78c6c;">1</span><span style="color:#89ddff;">)
</span><span style="color:#eeffff;">        </span><span style="font-style:italic;color:#c792ea;">let </span><span style="color:#89ddff;">_ = </span><span style="color:#82aaff;">print_3d_point</span><span style="color:#89ddff;">()
</span><span style="color:#eeffff;">    </span><span style="color:#89ddff;">}
</span><span style="color:#eeffff;">    ret </span><span style="color:#89ddff;">()
</span><span style="color:#89ddff;">}
</span><span style="color:#eeffff;">
</span><span style="font-style:italic;color:#c792ea;">let </span><span style="color:#89ddff;">_ = </span><span style="color:#82aaff;">print_1d_point</span><span style="color:#89ddff;">()
</span><span style="font-style:italic;color:#c792ea;">let </span><span style="color:#89ddff;">_ = </span><span style="color:#82aaff;">print_point</span><span style="color:#89ddff;">()
</span><span style="font-style:italic;color:#c792ea;">let</span><span style="color:#eeffff;"> res </span><span style="color:#89ddff;">= </span><span style="color:#82aaff;">print_3d_point</span><span style="color:#89ddff;">()
</span><span style="color:#eeffff;">print res
</span><span style="font-style:italic;color:#c792ea;">let </span><span style="color:#89ddff;">_ = </span><span style="color:#82aaff;">print_many</span><span style="color:#89ddff;">()
</span><span style="color:#eeffff;">ret res
</span></pre>

<h1>The Parser and Syntax</h1>
<p>The parser is bad (brittle) because I just wanted something simple that was easy to extend.
I think it's technically "recursive descent" but I don't like, tokenize so idk. The parser
has the worst errors and no recovery because I just didn't care about it.</p>
<p>Syntax is largely based on Rust's because it's a fairly clean and unambiguous syntax I'm
comfortable with.</p>
<blockquote>
<p><em>Why didn't you make it a lisp variant if you hate parsing?</em></p>
<p>I am really bad at reading/writing lispy things so this felt like a good tradeoff
in personal effort and comfort. It's also easier for me to intuit how something "should"
work when it looks like Rust code, because that's the language I understand the best.</p>
<p>Also if I tell something that it's Rust code, the syntax highlighting basically just works lol</p>
</blockquote>
<p>Notable deviations:</p>
<p>Newlines are very significant. It sucks, but most of the time you don't really notice.
It only really hurts for really complicated expressions and function declarations IMO.
As a consolation I at least let you not write semicolons, since newlines basically are
semicolons?</p>
<p><strong>Many things must all be contained to their own line:</strong></p>
<ul>
<li>Statements (including all subexprs)
<ul>
<li><code>let x: MyType = func1(func2(a, b, c), d)</code></li>
<li><code>ret x</code></li>
<li>...</li>
</ul>
</li>
<li>Block "headers"
<ul>
<li><code>struct MyStruct {</code></li>
<li><code>fn (a: Int, b: Bool) -&gt; Int {</code></li>
<li><code>if x {</code></li>
<li><code>} else {</code></li>
</ul>
</li>
<li>Struct fields (<code>x: Int</code>)</li>
<li>Closing braces (<code>}</code>)</li>
</ul>
<p><strong>Some things are extra verbose because I wanted the parser and interpretter to be trivial:</strong></p>
<ul>
<li>Expressions are not valid statements. So function calls must be part of a larger statement.
<ul>
<li>Typically <code>let _ = func()</code> is the easiest way to call a function just for its side-effects.</li>
</ul>
</li>
<li>Assigning to a pre-existing variable must be prefixed with <code>set</code>
<ul>
<li><code>set x = y</code></li>
</ul>
</li>
<li>The language isn't expression-oriented, so you must explicitly <code>set</code> and <code>ret</code> values.</li>
</ul>
<p><strong>There are no infix operators</strong>:</p>
<ul>
<li>We've got builtins like <code>add(x, y)</code> and <code>eq(x, y)</code>, final offer</li>
</ul>
<h1>The Checker (Static Analysis)</h1>
<p>This is basically the place I'm most interested in, so you'll find <code>src/checker.rs</code>
will have the most comments and discussion.</p>
<p>Currently all analysis is done directly by recursively walking the AST. All the
variables and types at every point in the program are tracked at every point in
the program, but this information is mutable and transient (sort of like we're
"executing" the program).</p>
<p>Ideally I'd like to write something that can create an (SSA?) Control Flow Graph
to facilitate other analyses like Definite Initialization (a major piece of
the ownership system in Rust, and just a staple of any good compiler because
it lets you report things like "value assigned to variable is never used").</p>
<p>I'm potentially also interested in faffing around with Generics and <em>maybe</em>
Higher-Rank Types? But I'm genuinely unsure about how to best represent and
implement some of that stuff (or rather, am saddened that type comparison might
have to be more complex than comparing type ids?).</p>
<p>To reiterate the notes in the example, the type system currently supports:</p>
<p>Basics:</p>
<ul>
<li>Basic primitives (Bool, Int, Str, <code>()</code>)</li>
<li>Basic control flow (ret, if, else, loop, break, continue)</li>
<li>Basic mutable variables (let, set)</li>
</ul>
<p>Types:</p>
<ul>
<li>First-class functions (which are all closures)
<ul>
<li>Closures capture state by-value at the point where execution reaches their decl.</li>
</ul>
</li>
<li>Structural product types (tuples)</li>
<li>Nominal product types (structs)</li>
</ul>
<p>Analysis:</p>
<ul>
<li>Optional Static type checking
<ul>
<li>Types of variables can be inferred because exprs currently always have a known type.</li>
<li>Functions must always declare the types of args/returns
<ul>
<li>Although if the return type is omitted it's assumed to be <code>()</code></li>
</ul>
</li>
<li>Properly handles shadowing and scoping of nominal types</li>
</ul>
</li>
<li>Statically validates variable accesses are in scope</li>
<li>Statically validates control flow (can't <code>continue</code> outside a loop)</li>
<li>Statically computes closure captures</li>
</ul>
<h1>The Interpreter</h1>
<p>It's a pretty simple "untyped" interpreter of the AST. Runtime values do have basic type
tagging so we can check if something is a function or boolean for the places where
only those types make sense.</p>
<p>It <em>almost</em> doesn't depend at all on the checker, but the closure capture analysis
adds some required information to the AST.</p>
<p>Not depending on the checker helps catch bugs in the checker.</p>
<p>Nothing is terribly optimized. Any time a value is semantically moved it's Cloned
(and things like tuples, closures, and structs all contain Vecs!). But even given
that, compiling and evaluating the ~100 programs that are currently in the tests
is basically instantaneous on my beefy work machine.</p>
<p>There's a lot more lifetimes in the interpreter than there really should be.
I make a point of keeping all string literals as pointers into the original
program text, because that was aesthetically important to me.</p>
</div></main><footer class="footer"><a href="https://github.com/Gankra/bappy-script"><div class="github-icon" aria-hidden="true"></div></a><span>bappy-script, MIT OR Apache-2.0 license.</span></footer></div><div><script src="/bappy-script/artifacts.js"></script></div></body></html>